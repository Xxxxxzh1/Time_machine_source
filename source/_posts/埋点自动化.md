---
title: 埋点自动化
date: 2022-07-30 20:32:50
tags: 工作
categories: 工作
---

`背景：客户端埋点上报功能一旦出现问题，发布上线后会影响数据统计、市场投放等。因此在客户端发布pipeline中加入自动化步骤，用以验证该功能点，避免因小失大。`

# 实现原理
**通过埋点源数据接口拉取埋点日志，再进行数据提取+校验**

- 接口入参：
  - resource -- 需要查询的业务线
  - userid -- 用户userid
  - begin -- 开始时间点（时间戳精确到秒）
  - end -- 结束时间点（时间戳精确到秒）
  - os -- 终端类型
  - page_size -- 每页查询的数据量
  - page_num -- 查询的页数
  - method -- 固定为GET

# 代码逻辑
**数据获取**
- CI命令行运行变量为os、action，以传入python脚本中作为入参
  - ​os为要校验的终端，可为：Android、iphone
  - action为要校验的埋点action，可为：activeclient、click...（建议选择强校验点）
  - 数据量为单页10000条，防止数据分页产生数据无法验证

**结果判断**
- 遍历接口返回的所有结果，是否存在action、os同时满足的日志

**前置依赖**
- 该步骤建议放在UI相关pipeline步骤之后，前置自动化用户操作后的埋点信息可共用，无需手动打点